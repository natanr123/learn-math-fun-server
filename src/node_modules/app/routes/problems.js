import express from 'express';
import Problem from "app/models/Problem";
import { randomIntRange, shuffle } from 'okrand';
const router = express.Router();
function create(req, res) {

    console.log('Creating Problem: ',req.body);
    let problem = new Problem(req.body);
    problem.save(function (err) {
        if (err) {
            console.log('error',err);
            res.send({error: 'something bad happened'});
        } else {

            res.send({problem: problem});
        }
    });
}


function answer(req, res) {
    let body = req.body;
    let id = body.id;
    let answer = body.answer;
    Problem.findById(id).then(problem=>{
        let isCorrect = (problem.correctAnswer ===  answer);
        res.send({isCorrect});
    });

}


function random(req, res) {
    Problem.find({}, function(err, problems){
        if(err){
            console.log('error getting problems: ',err);
            res.send({error: 'something bad happened'});
        } else {
            //console.log(problems);
            let length = problems.length;
            if(length === 0) {
                throw new Error('No Problems');
            }
            let randomIndex = randomIntRange(0,length-1);
            console.log('randomIndex: ',randomIndex);
            let problem  = problems[randomIndex];
            let options = problem.buildOptions();
            res.send({problem, options});
        }
    })
}

function list(req, res) {
    Problem.find({}, function(err, problems){
        if(err){
            console.log('error getting problems: ',err);
            res.send({error: 'something bad happened'});
        } else {
            res.send(problems);
        }
    });

}

router.post('/', create);

router.get('/', list);

router.get('/random', random);
router.post('/answer', answer);


export default router;