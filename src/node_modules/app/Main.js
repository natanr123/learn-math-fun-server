import express from 'express';
import Router from 'app/Router'
import usersRouter from 'app/routes/users';
import  LoggerMiddleware from 'app/middlewares/LoggerMiddleware'
import User from 'app/models/User'
import bodyParser from "body-parser";

import problemsRouter from 'app/routes/problems'

class Main {
    static start() {

        const app = express();
        //app.use(LoggerMiddleware);


        var mongoose = require('mongoose');

        const dbName = process.env.DB_NAME;
        const dbUsername = process.env.DB_USERNAME;
        const dbPassword = process.env.DB_PASSWORD;
        const dbHost = process.env.DB_HOST;
        //var mongoDB = 'mongodb://127.0.0.1/my_database';
        var mongoDB = `mongodb+srv://${dbUsername}:${dbPassword}@${dbHost}/${dbName}?retryWrites=true`;

        console.log('mongoDB: ', mongoDB);
        mongoose.connect(mongoDB);
        mongoose.Promise = global.Promise;
        var db = mongoose.connection;

        db.on('error', console.error.bind(console, 'MongoDB connection error:'));



        app.use(function(req, res, next) {
            res.header("Access-Control-Allow-Origin", "*");
            res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
            next();
        });
        app.use(bodyParser.urlencoded({ extended: false }));
        app.use(bodyParser.json());


        //Router.start(app);
        app.use('/users', usersRouter);
        app.use('/problems', problemsRouter);
        app.listen(3001, () => console.log('Example app listening on port 3001!'));
        console.log('vvvvvvvvvvvvvvvvvvvvvvvvvvvvvv');

    }
}
Main.start();